var mainAppCtrls=angular.module("mainAppCtrls");mainAppCtrls.controller("DashboardCtrl",["$scope",function($scope){}]);var mainAppCtrls=angular.module("mainAppCtrls");mainAppCtrls.controller("AdminCreateCtrl",["$scope","$stateParams","$alert","$translate","Admin","$state",function($scope,$stateParams,$alert,$translate,Admin,$state){var _translations={};$translate(["PASSWORDS_IDENTICAL_ERROR","EMAIL","USERNAME","NEW_PASSWORD","REPEAT_PASSWORD","ALERT_CREATE_ADMIN_FAIL","ALERT_CREATE_ADMIN_SUCCESS","TITLE_SUCCESS","TITLE_ERROR"]).then(function(translations){_translations=translations,$scope.placeholder={username:_translations.USERNAME,password:_translations.NEW_PASSWORD,confirm_password:_translations.REPEAT_PASSWORD,email:_translations.EMAIL},$scope.form={},$scope.myAlert=$alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.PASSWORDS_IDENTICAL_ERROR,container:"#alert",show:!1,dismissable:!1})}),$scope.form={},$scope.myAlert=$alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.PASSWORDS_IDENTICAL_ERROR,container:"#alert",show:!1,dismissable:!1});var token=$stateParams.token;$scope.sendInfo=function(){var match=$scope.form.password_confirm==$scope.form.password;if(match){$scope.myAlert.hide();var _data={email:$scope.form.email,password:$scope.form.password,code:token,username:$scope.form.username};Admin.createAdmin(_data).$promise.then(function(response){$state.go("login")},function(response){var _msg="";switch(httpResponse.status){case 400:_msg=_translations.ALERT_NO_CONTENT;case 401:_msg=_translations.ALERT_FALSE_TOKEN;break;case 403:_msg=_translations.ALTERT_CREATE_ADMIN_FAIL}$alert({title:_translations.TITLE_ERROR,type:"danger",content:_msg,container:"#alert",dismissable:!0,show:!0,duration:15})})}else $scope.form.password_confirm="",$scope.myAlert.show()}}]);var mainAppCtrls=angular.module("mainAppCtrls");mainAppCtrls.controller("EmailTemplateCtrl",["$scope","EmailTemplate","$alert","$modal","$translate",function($scope,EmailTemplate,$alert,$modal,$translate){var _translations={};$translate(["ALERT_EMAILTEMPLATE_DELETE_SUCCESS","ALERT_EMAILTEMPLATE_DELETE_FAIL","TITLE_ERROR","TITLE_SUCCESS"]).then(function(translations){_translations=translations});var loadTemplates=function(){$scope.loading=!0,EmailTemplate.getAll().$promise.then(function(value){$scope.data=value,$scope.loading=!1},function(httpResponse){$scope.loading=!1})};loadTemplates(),$scope.delete=function(_id){EmailTemplate.delete({id:_id}).$promise.then(function(httpResponse){$alert({title:_translations.TITLE_SUCCESS,type:"success",container:"#alert",show:!0,dismissable:!1,content:_translations.ALERT_EMAILTEMPLATE_DELETE_SUCCESS,duration:20}),loadTemplates()},function(httpResponse){$alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.ALERT_EMAILTEMPLATE_DELETE_FAIL+" ("+httpResponse.status+")",container:"#alert",dismissable:!1,show:!0,duration:20})})}}]);var mainAppCtrls=angular.module("mainAppCtrls");mainAppCtrls.controller("AdminEditWorkshopCtrl",["$scope","Workshops","AdminWorkshop","$stateParams","$translate","$alert","$state",function($scope,Workshops,AdminWorkshop,$stateParams,$translate,$alert,$state){var _workshopId=$stateParams.id,_originalData={};$scope.workshop={};var _translations={};$translate(["ALERT_WORKSHOP_EDIT_SUCCESS","TITLE_SUCCESS","TITLE_ERROR","ALERT_WORKSHOP_EDIT_FAIL","ALERT_WORKSHOP_NOT_FOUND","ALERT_WORKSHOP_IN_PAST","ALERT_NEGATIVE_COST","ALERT_NEGATIVE_PARTICIPANTS"]).then(function(translations){_translations=translations});$scope.discardChanges=function(){$scope.workshop.title=_originalData.title,$scope.workshop.description=_originalData.description,$scope.workshop.cost=_originalData.cost,$scope.workshop.requirement=_originalData.requirement,$scope.workshop.location=_originalData.location,$scope.workshop.start_at=_originalData.start_at,$scope.workshop.end_at=_originalData.end_at,$scope.workshop.duration=_originalData.duration,$scope.workshop.max_participants=_originalData.max_participants},$scope.confirmChanges=function(){var reformatDate=function(_date){if(null==_date)return"";var str=_date.getFullYear()+"-"+(_date.getMonth()+1)+"-"+_date.getDate()+" ";return _date.getHours()<10&&(str+="0"),str+=_date.getHours()+":",_date.getMinutes()<10&&(str+="0"),str+=_date.getMinutes()+":",_date.getSeconds()<10&&(str+="0"),str+=_date.getSeconds()},_sa=Date.parse($scope.workshop.start_at),_duration=$scope.workshop.duration,_ea=new Date(_sa+_duration+36e5),error=!1;$scope.workshop.cost<0&&($alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.ALERT_NEGATIVE_COST,container:"#alert",dismissable:!1,show:!0,duration:30}),error=!0),$scope.workshop.max_participants<0&&($alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.ALERT_NEGATIVE_PARTICIPANTS,container:"#alert",dismissable:!1,show:!0,duration:30}),error=!0);var now=new Date;if($scope.workshop.start_at<now&&($alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.ALERT_WORKSHOP_IN_PAST,container:"#alert",dismissable:!1,show:!0,duration:30}),error=!0),error)return!1;var _dataToSend={title:$scope.workshop.title,description:$scope.workshop.description,cost:$scope.workshop.cost,requirements:$scope.workshop.requirement,location:$scope.workshop.location,start_at:reformatDate(new Date(_sa)),end_at:reformatDate(_ea),max_participants:$scope.workshop.max_participants};AdminWorkshop.edit({id:_workshopId},_dataToSend).$promise.then(function(value){_originalData={title:value.title,description:value.title,cost:value.title,requirement:value.title,location:value.title,start_at:value.title,end_at:value.end_at,max_participants:value.max_participants},$alert({title:_translations.TITLE_SUCCESS,type:"success",content:_translations.ALERT_WORKSHOP_EDIT_SUCCESS+' "'+_originalData.title+'"',container:"#alert",dismissable:!0,show:!0,duration:30}),$state.go("administrator_workshop_details",{id:value.id})},function(httpResponse){$alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.ALERT_WORKSHOP_EDIT_FAIL+"("+httpResponse.status+")",container:"#alert",dismissable:!0,show:!0,duration:60})})},$scope.loading=!0,Workshops.get({id:_workshopId}).$promise.then(function(value){_originalData={title:value.title,description:value.description,cost:value.cost,requirement:value.requirement,location:value.location,start_at:value.start_at,end_at:value.end_at,max_participants:value.max_participants};var _ea=Date.parse(_originalData.end_at),_sa=Date.parse(_originalData.start_at);_originalData.duration=_ea-_sa,$scope.workshop.title=_originalData.title,$scope.workshop.description=_originalData.description,$scope.workshop.cost=_originalData.cost,$scope.workshop.requirement=_originalData.requirement,$scope.workshop.location=_originalData.location,$scope.workshop.start_at=_originalData.start_at,$scope.workshop.end_at=_originalData.end_at,$scope.workshop.duration=_originalData.duration,$scope.workshop.max_participants=_originalData.max_participants,$scope.loading=!1},function(httpResponse){404===httpResponse.status&&$alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.ALERT_WORKSHOP_NOT_FOUND,container:"#alert",dismissable:!1,show:!0}),$scope.loading=!1})}]);var mainAppCtrls=angular.module("mainAppCtrls");mainAppCtrls.controller("adminEmailConfirmCtrl",["$scope","EmailTemplate","$translate","$alert","$stateParams","Email",function($scope,EmailTemplate,$translate,$alert,$stateParams,Email){$scope.email={},$scope.workshopid=$stateParams.id;var _translations={};$translate(["TITLE_SUCCESS","TITLE_ERROR","ALERT_EMAILCONFIRM_SEND_SUCCESS","ALERT_EMAILCONFIRM_SEND_FAIL"]).then(function(translations){_translations=translations}),EmailTemplate.getAll().$promise.then(function(response){$scope.templates=response},function(response){}),$scope.loadTemplate=function(){var template=JSON.parse(JSON.stringify($scope.selectedTemplate));$scope.email.body=template.email_body,$scope.email.subject=template.email_subject},$scope.send=function(){var _data={content:$scope.email.body,subject:$scope.email.subject};Email.sendEmail({id:$scope.workshopid},_data).$promise.then(function(response){$alert({type:"success",content:_translations.ALERT_EMAILCONFIRM_SEND_SUCCESS,title:_translations.TITLE_SUCCESS,dissmisable:!1,show:!0,duration:20})},function(response){$alert({type:"danger",content:_translations.ALERT_EMAILCONFIRM_SEND_FAIL+response.status,title:_translations.TITLE_ERROR,dissmisable:!1,show:!0,duration:20})})},$scope.discard=function(){$scope.email.subject="",$scope.email.body=""}}]);var mainAppCtrls=angular.module("mainAppCtrls");mainAppCtrls.controller("AdminNewWorkshopCtrl",["$scope","Workshops","AdminWorkshop","WorkshopTemplate","$translate","$alert","$state",function($scope,Workshops,AdminWorkshop,WorkshopTemplate,$translate,$alert,$state){$scope.workshop={},WorkshopTemplate.getAll().$promise.then(function(response){$scope.templates=response},function(response){}),$scope.loadTemplate=function(){$scope.workshop=JSON.parse(JSON.stringify($scope.selectedTemplate));var _ea=Date.parse($scope.workshop.end_at),_sa=Date.parse($scope.workshop.start_at);$scope.workshop.duration=new Date(_ea-_sa),$scope.workshop.start_at=(new Date).setHours(0,0,0,0)},$scope.workshop.duration=new Date(0);var _translations={};$translate(["ALERT_WORKSHOP_NEW_SUCCESS","TITLE_SUCCESS","TITLE_ERROR","ALERT_WORKSHOP_NEW_FAIL","ALERT_NEGATIVE_COST","ALERT_NEGATIVE_PARTICIPANTS","ALERT_WORKSHOP_IN_PAST"]).then(function(translations){_translations=translations}),$scope.sendInfo=function(){var reformatDate=function(_date){if(null==_date)return"";var str=_date.getFullYear()+"-"+(_date.getMonth()+1)+"-"+_date.getDate()+" ";return _date.getHours()<10&&(str+="0"),str+=_date.getHours()+":",_date.getMinutes()<10&&(str+="0"),str+=_date.getMinutes()+":",_date.getSeconds()<10&&(str+="0"),str+=_date.getSeconds()},_sa=new Date($scope.workshop.start_at),_duration=$scope.workshop.duration;_duration=Date.UTC(_duration.getFullYear(),_duration.getMonth(),_duration.getDate(),_duration.getHours(),_duration.getMinutes());var _ea=_sa;_ea.setMilliseconds(_sa.getMilliseconds()+_duration);var now=new Date,error=!1;if($scope.workshop.cost<0&&($alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.ALERT_NEGATIVE_COST,container:"#alert",dismissable:!1,show:!0}),error=!0),$scope.workshop.max_participants<0&&($alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.ALERT_NEGATIVE_PARTICIPANTS,container:"#alert",dismissable:!1,show:!0}),error=!0),$scope.workshop.start_at<now&&($alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.ALERT_WORKSHOP_IN_PAST,container:"#alert",dismissable:!1,show:!0}),error=!0),error)return!1;var data={title:$scope.workshop.title,description:$scope.workshop.description,cost:$scope.workshop.cost,requirements:$scope.workshop.requirement,location:$scope.workshop.location,start_at:reformatDate($scope.workshop.start_at),end_at:reformatDate(_ea),max_participants:$scope.workshop.max_participants};AdminWorkshop.putWorkshop(data).$promise.then(function(httpResponse){$alert({title:_translations.TITLE_SUCCESS,type:"success",content:_translations.ALERT_WORKSHOP_NEW_SUCCESS+' "'+data.title+'"',container:"#alert",dismissable:!1,show:!0}),$state.go("administrator_workshop_details",{id:httpResponse.id})},function(httpResponse){$alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.ALERT_WORKSHOP_NEW_FAIL+" ("+httpResponse.status+")",container:"#alert",dismissable:!1,show:!0})})},$scope.discard=function(){$scope.workshop.title="",$scope.workshop.description="",$scope.workshop.cost="",$scope.workshop.requirement="",$scope.workshop.location="",$scope.workshop.sharedDate="",$scope.workshop.start_at="",$scope.workshop.duration="",$scope.workshop.max_participants="",null!=$scope.selectedTemplate&&($scope.workshop=JSON.parse(JSON.stringify($scope.selectedTemplate)))}}]);var mainAppCtrls=angular.module("mainAppCtrls");mainAppCtrls.controller("adminWorkshopDetailsCtrl",["$scope","Workshops","Participants","$stateParams","$alert","printer","$translate","AdminWorkshop",function($scope,Workshops,Participants,$stateParams,$alert,printer,$translate,AdminWorkshop){var _translations={};$translate(["TITLE_SUCCESS","TITLE_ERROR","TITLE_INFO","ALERT_NO_PARTICIPANTS","ALERT_SUCCESSFUL_OVERBOOK","ALERT_FAIL_OVERBOOK","ALERT_SUCCESSFUL_BLACKLISTED","ALERT_SUCCESSFUL_REMOVED_USER","ALERT_FAILED_REMOVED_USER","PARTICIPATION_CONFIRM_SUCCESS","PARTICIPATION_CONFIRM_ERROR"]).then(function(translations){_translations=translations}),$scope.workshopid=$stateParams.id,$scope.loading=!0,Workshops.get({id:$scope.workshopid}).$promise.then(function(value,httpResponse){$scope.workshop=value;var _ea=Date.parse($scope.workshop.end_at),_sa=Date.parse($scope.workshop.start_at),_durationInMs=_ea-_sa,_duration=("0"+Math.floor(_durationInMs/36e5)).slice(-2)+":"+("0"+Math.floor(_durationInMs%36e5/6e4)).slice(-2);$scope.workshop.duration=_duration,$scope.loading=!1},function(httpResponse){$alert({title:_translations.TITLE_ERROR,type:"danger",content:httpResponse.status,container:"#alert",dismissable:!1,show:!0}),$scope.loading=!1});var loadParticipants=function(){$scope.loading=!0,AdminWorkshop.participants({id:$scope.workshopid}).$promise.then(function(value,httpResponse){$scope.participants=value,$scope.loading=!1},function(httpResponse){switch(httpResponse.status){case 404:$alert({title:_translations.TITLE_INFO,type:"info",content:_translations.ALERT_NO_PARTICIPANTS,container:"#alertParticipant",dismissable:!1,show:!0,animation:"am-fade-and-slide-top"})}$scope.loading=!1})},loadWaitinglist=function(){$scope.loading=!0,AdminWorkshop.waitinglist({id:$scope.workshopid}).$promise.then(function(response){$scope.waitingList=response,$scope.loading=!1},function(response){$scope.loading=!1})};loadParticipants(),loadWaitinglist(),$scope.printList=function(){printer.print("resources/views/participantList.tpl.html",$scope.participants,$scope.workshop)},$scope.overbook=function(_id){AdminWorkshop.overbook({id:$scope.workshopid,participantid:_id}).$promise.then(function(response){$alert({type:"success",duration:20,container:"#alert",content:_translations.ALERT_SUCCESSFUL_OVERBOOK,show:"true",title:_translations.TITLE_SUCCESS}),loadParticipants(),loadWaitinglist()},function(response){$alert({type:"danger",duration:20,container:"#alert",content:_translations.ALERT_FAIL_OVERBOOK,show:"true",title:_translations.TITLE_ERROR})})},$scope.blacklistUser=function(_id){Participants.blacklist({id:_id}).$promise.then(function(response){$alert({type:"success",duration:20,container:"#alert",content:_translations.ALERT_SUCCESSFUL_BLACKLISTED,show:!0,title:_translations.TITLE_SUCCESS}),loadParticipants(),loadWaitinglist()},function(response){$alert({type:"danger",duration:20,container:"#alert",content:_translations.ALERT_FAILED_BLACKLISTED+"("+response.status+")",show:!0,title:_translations.TITLE_ERROR})})},$scope.remove=function(_participant,_workshop){Participants.remove({participant:_participant,workshop:_workshop}).$promise.then(function(response){$alert({type:"success",duration:20,container:"#alert",content:_translations.ALERT_SUCCESSFUL_REMOVED_USER,show:!0,title:_translations.TITLE_SUCCESS}),loadParticipants(),loadWaitinglist()},function(response){$alert({type:"danger",duration:20,container:"#alert",content:_translations.ALERT_FAILED_REMOVED_USER+"("+response.status+")",show:!0,title:_translations.TITLE_ERROR})})},$scope.confirmUser=function(_workshop,_user){AdminWorkshop.confirmParticipation({id:_workshop,participant:_user}).$promise.then(function(response){$alert({type:"success",duration:20,container:"#alert",content:_translations.PARTICIPATION_CONFIRM_SUCCESS,show:!0,title:_translations.TITLE_SUCCESS})},function(response){$alert({type:"danger",duration:20,container:"#alert",content:_translations.PARTICIPATION_CONFIRM_ERROR+response.statusText,show:!0,title:_translations.TITLE_ERROR})})}}]);var mainAppCtrls=angular.module("mainAppCtrls");mainAppCtrls.controller("adminWorkshopManagementCtrl",["$scope","AdminWorkshop","$alert","$translate",function($scope,AdminWorkshop,$alert,$translate){$scope.myAlert,$scope.currentList=[],$scope.elapsedList=[];var _translations={};$translate(["ALERT_WORKSHOP_DELETE_SUCCESS","ALERT_INTERNAL_SERVER_ERROR","ALERT_WORKSHOP_DELETE_FAIL"]).then(function(translations){_translations=translations});var compareToCurrent=function(a){var d1=new Date,d2=new Date(a);return d2.getTime()>d1.getTime()};$translate(["TITLE_ERROR","ERROR_NO_WORKSHOPS","EMPTY_WORKSHOP","TITLE_SUCCESS"]).then(function(translations){$scope.errorTitle=translations.TITLE_ERROR,$scope.errorMsg=translations.ERROR_NO_WORKSHOPS,$scope.successTitle=translations.TITLE_SUCCESS,$scope.emptyMsg=translations.EMPTY_WORKSHOP});var loadWorkshops=function(){$scope.loading=!0,AdminWorkshop.gethistory().$promise.then(function(value){var workshopList=value;$scope.currentList=[],$scope.elapsedList=[],$scope.loading=!1;for(var i=0;i<workshopList.length;i++)compareToCurrent(workshopList[i].start_at)?$scope.currentList.push(workshopList[i]):$scope.elapsedList.push(workshopList[i])},function(httpResponse){switch(httpResponse.status){case 204:$scope.myAlert=$alert({title:$scope.errorTitle,type:"danger",content:$scope.emptyMsg,container:"#alert",dismissable:!1,show:!0});break;case 404:$scope.myAlert=$alert({title:$scope.errorTitle,type:"danger",content:$scope.errorMsg,container:"#alert",dismissable:!1,show:!0});break;case 500:$scope.myAlert=$alert({title:$scope.errorTitle,type:"danger",content:_translations.ALERT_INTERNAL_SERVER_ERROR+" ("+httpResponse.status+")",container:"#alert",dismissable:!1,show:!0})}$scope.loading=!1})};loadWorkshops(),$scope.delete=function(_id){AdminWorkshop.delete({id:_id}).$promise.then(function(httpResponse){$alert({title:$scope.successTitle,type:"success",container:"#alert",show:!0,dismissable:!0,content:_translations.ALERT_WORKSHOP_DELETE_SUCCESS,duration:20}),loadWorkshops()},function(httpResponse){$alert({title:$scope.errorTitle,type:"danger",container:"#alert",show:!0,dismissable:!0,content:_translations.ALERT_WORKSHOP_DELETE_FAIL+" ("+httpResponse.status+")",duration:20})})}}]);var mainAppCtrls=angular.module("mainAppCtrls");mainAppCtrls.controller("AdministratorManagementCtrl",["$scope","Admin","$alert","$translate",function($scope,Admin,$alert,$translate){$scope.loading=!0;var _translations={};$translate(["INVITED_ADMINISTRATOR_EMAIL","TITLE_ERROR","TITLE_SUCCESS","INVITED_ADMINISTRATOR_EMAIL_ERROR","ALERT_DELETE_ADMIN_FAILED","ALERT_DELETE_ADMIN_SUCCESS"]).then(function(translations){_translations=translations});var loadList=function(){$scope.loading=!0,Admin.list().$promise.then(function(value){$scope.admins=value,$scope.loading=!1},function(httpResponse){alert(httpResponse.status),$scope.loading=!1})};loadList(),$scope.deleteAdmin=function(_id){$scope.loading=!0,Admin.delete({id:_id}).$promise.then(function(value){loadList(),$alert({title:_translations.TITLE_SUCCESS,type:"success",content:_translations.ALERT_DELETE_ADMIN_SUCCESS,container:"#alert",dismissable:!0,show:!0,duration:10})},function(httpResponse){$scope.loading=!1,$alert({type:_translations.TITLE_ERROR,title:"Error",content:_translations.ALERT_DELETE_ADMIN_FAILED,container:"#alert",show:!0,dismissable:!1,duration:30})})},$scope.invite=function(){Admin.invite({email:$scope.admin_mail}).$promise.then(function(value){$alert({title:_translations.TITLE_SUCCESS,type:"success",content:_translations.INVITED_ADMINISTRATOR_EMAIL,container:"#alert",dismissable:!0,show:!0,duration:30})},function(httpResponse){$alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.INVITED_ADMINISTRATOR_EMAIL_ERROR,container:"#alert",dismissable:!0,show:!0,duration:60})})}}]);var mainAppCtrls=angular.module("mainAppCtrls");mainAppCtrls.controller("BlacklistCtrl",["$scope","Participants","$alert","$modal","$translate",function($scope,Participants,$alert,$modal,$translate){var _translations={};$translate(["ALERT_BLACKLIST_DELETE_PARTICIPANT","ALERT_BLACKLIST_DELETE_PARTICIPANT_FAIL","TITLE_SUCCESS","TITLE_ERROR"]).then(function(translations){_translations=translations});var loadBlacklist=function(){$scope.loading=!0,Participants.getblacklistall().$promise.then(function(value){$scope.userdata=value,$scope.loading=!1},function(httpResponse){$scope.loading=!1})};$scope.delete=function(_id){$scope.deleting=!0,Participants.removeBlacklist({id:_id}).$promise.then(function(httpResponse){$scope.deleting=!1,$alert({title:_translations.TITLE_SUCCESS,type:"success",container:"#alert",show:!0,dismissable:!1,content:_translations.ALERT_BLACKLIST_DELETE_PARTICIPANT,duration:20}),loadBlacklist()},function(httpResponse){$scope.deleting=!1,$alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.ALERT_BLACKLIST_DELETE_PARTICIPANT_FAIL+" ("+httpResponse.status+")",container:"#alert",dismissable:!1,show:!0})})},loadBlacklist()}]);var mainAppCtrls=angular.module("mainAppCtrls");mainAppCtrls.controller("ContactCtrl",["$scope","Admin",function($scope,Admin){$scope.contact={},Admin.getContact().$promise.then(function(response){204!=response.status&&($scope.contact=response.content)},function(response){})}]);var mainAppCtrls=angular.module("mainAppCtrls");mainAppCtrls.controller("EditEmailTemplateCtrl",["$scope","EmailTemplate","$stateParams","$translate","$alert","$state",function($scope,EmailTemplate,$stateParams,$translate,$alert,$state){var _workshopId=$stateParams.id,_originalData={},_translations={};$translate(["ALERT_EMAILTEMPLATE_EDIT_SUCCESS","TITLE_SUCCESS","TITLE_ERROR","ALERT_EMAILTEMPLATE_EDIT_FAIL","ALERT_EMAILTEMPLATE_NOT_FOUND"]).then(function(translations){_translations=translations}),$scope.discardChanges=function(){$scope.title=_originalData.title,$scope.email=_originalData.email},$scope.confirmChanges=function(){var _dataToSend={template_name:"",email_subject:"",email_body:""},_changedData={title:$scope.title,email:$scope.email};_changedData.title!=_originalData.title&&(_dataToSend.template_name=_changedData.title),_changedData.email.body!=_originalData.email.body&&(_dataToSend.email_body=_changedData.email.body),_changedData.email.subject!=_originalData.email.subject&&(_dataToSend.email_subject=_changedData.email.subject),EmailTemplate.edit({id:_workshopId},_dataToSend).$promise.then(function(value){_originalData={title:value.template_name,email:{subject:value.email_subject,body:value.email_body}},$alert({title:_translations.TITLE_SUCCESS,type:"success",content:_translations.ALERT_EMAILTEMPLATE_EDIT_SUCCESS+' "'+_originalData.title+'"',container:"#alert",dismissable:!0,show:!0,duration:30}),$state.go("email_template")},function(httpResponse){$alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.ALERT_EMAILTEMPLATE_EDIT_FAIL+"("+httpResponse.status+")",container:"#alert",dismissable:!0,show:!0,duration:60})})},$scope.loading=!0,EmailTemplate.get({id:_workshopId}).$promise.then(function(value){_originalData={title:value.template_name,email:{subject:value.email_subject,body:value.email_body}},$scope.title=_originalData.title,$scope.email={body:_originalData.email.body,subject:_originalData.email.subject},$scope.loading=!1},function(httpResponse){404===httpResponse.status&&$alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.ALERT_EMAILTEMPLATE_NOT_FOUND,container:"#alert",dismissable:!1,show:!0}),$scope.loading=!1})}]);var mainAppCtrls=angular.module("mainAppCtrls");mainAppCtrls.controller("EditWorkshopTemplateCtrl",["$scope","WorkshopTemplate","$stateParams","$translate","$alert","$state",function($scope,WorkshopTemplate,$stateParams,$translate,$alert,$state){var _workshopId=$stateParams.id;$scope.workshop={};var _originalData={},_translations={};$translate(["ALERT_WORKSHOPTEMPLATE_EDIT_SUCCESS","ALERT_WORKSHOPTEMPLATE_EDIT_FAIL","ALERT_WORKSHOPTEMPLATE_NOT_FOUND","TITLE_SUCCESS","TITLE_ERROR"]).then(function(translations){_translations=translations}),$scope.discard=function(){$scope.workshop.title=_originalData.title,$scope.workshop.description=_originalData.description,$scope.workshop.cost=_originalData.cost,$scope.workshop.requirements=_originalData.requirements,$scope.workshop.location=_originalData.location,$scope.workshop.start_at=_originalData.start_at,$scope.workshop.end_at=_originalData.end_at,$scope.workshop.max_participants=_originalData.max_participants},$scope.sendInfo=function(){var reformatDate=function(_date){if(null==_date)return"";var str=_date.getFullYear()+"-"+(_date.getMonth()+1)+"-"+_date.getDate()+" ";return _date.getHours()<10&&(str+="0"),str+=_date.getHours()+":",_date.getMinutes()<10&&(str+="0"),str+=_date.getMinutes()+":",_date.getSeconds()<10&&(str+="0"),str+=_date.getSeconds()},_sa=Date.parse($scope.workshop.start_at),_duration=$scope.workshop.duration,_ea=new Date(_sa+_duration),error=!1;$scope.workshop.cost<0&&($alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.ALERT_NEGATIVE_COST,container:"#alert",dismissable:!1,show:!0}),error=!0),$scope.workshop.max_participants<0&&($alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.ALERT_NEGATIVE_PARTICIPANTS,container:"#alert",dismissable:!1,show:!0}),error=!0);var now=new Date;if($scope.workshop.start_at<now&&($alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.ALERT_WORKSHOP_IN_PAST,container:"#alert",dismissable:!1,show:!0}),error=!0),error)return!1;var data={title:$scope.workshop.title,description:$scope.workshop.description,cost:$scope.workshop.cost,requirement:$scope.workshop.requirement,location:$scope.workshop.location,start_at:reformatDate(new Date(_sa)),end_at:reformatDate(_ea),max_participants:$scope.workshop.max_participants};WorkshopTemplate.edit({id:_workshopId},data).$promise.then(function(value){$alert({title:_translations.TITLE_SUCCESS,type:"success",content:_translations.ALERT_WORKSHOPTEMPLATE_EDIT_SUCCESS+' "'+_originalData.title+'"',container:"#alert",dismissable:!0,show:!0,duration:30}),$state.go("workshop_template")},function(httpResponse){$alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.ALERT_WORKSHOPTEMPLATE_EDIT_FAIL+"("+httpResponse.status+")",container:"#alert",dismissable:!0,show:!0,duration:60})})},$scope.loading=!0,WorkshopTemplate.get({id:_workshopId}).$promise.then(function(value){var _ea=Date.parse(value.end_at),_sa=Date.parse(value.start_at),_duration=_ea-_sa;_originalData={title:value.title,description:value.description,cost:value.cost,requirement:value.requirement,location:value.location,duration:_duration,start_at:value.start_at,end_at:value.end_at,max_participants:value.max_participants},$scope.workshop.title=_originalData.title,$scope.workshop.description=_originalData.description,$scope.workshop.cost=_originalData.cost,$scope.workshop.requirement=_originalData.requirement,$scope.workshop.location=_originalData.location,$scope.workshop.duration=_originalData.duration,$scope.workshop.start_at=_originalData.start_at,$scope.workshop.end_at=_originalData.end_at,$scope.workshop.max_participants=_originalData.max_participants,$scope.loading=!1},function(httpResponse){404===httpResponse.status&&$alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.ALERT_WORKSHOPTEMPLATE_NOT_FOUND,container:"#alert",dismissable:!1,show:!0}),$scope.loading=!1})}]);var mainAppCtrls=angular.module("mainAppCtrls");mainAppCtrls.controller("EnrollmentConfirmCtrl",["$scope","Workshops","$stateParams","$alert","$translate",function($scope,Workshops,$stateParams,$alert,$translate){var _translations={};$translate(["TITLE_ERROR","TITLE_SUCCESS","ALERT_NOT_FOUND_WORKSHOP","ALERT_SUCCESSFULLY_ENROLLED_WORKSHOP","ALERT_INVALID_ENROLMENT_LINK"]).then(function(translations){_translations=translations}),$scope.workshop={},$scope.loading=!0,Workshops.getWorkshop({id:$stateParams.workshopid}).$promise.then(function(value){$scope.workshop=value;var _ea=Date.parse($scope.workshop.end_at),_sa=Date.parse($scope.workshop.start_at);$scope.workshop.duration=new Date(_ea-_sa)},function(value){$alert({container:"#alert",dismissable:!1,show:!0,title:_translations.TITLE_ERROR,content:_translations.ALERT_NOT_FOUND_WORKSHOP,type:"danger"})}),Workshops.confirmEnroll({id:$stateParams.workshopid,userid:$stateParams.userid,token:$stateParams.token}).$promise.then(function(value){switch(console.log(value),value.code){case 200:$alert({container:"#alert",dismissable:!1,show:!0,title:_translations.TITLE_SUCCESS,content:_translations.ALERT_SUCCESSFULLY_ENROLLED_WORKSHOP+'"'+$scope.workshop.title+'"',type:"success"});break;case 201:$alert({container:"#alert",dismissable:!1,show:!0,title:_translations.TITLE_SUCCESS,content:value.message+'"'+$scope.workshop.title+'"',type:"success"})}$scope.loading=!1},function(httpResponse){switch(httpResponse.code){case 404:$alert({container:"#alert",dismissable:!1,show:!0,title:_translations.TITLE_ERROR,content:_translations.ALERT_INVALID_ENROLMENT_LINK,type:"danger"})}$scope.loading=!1})}]);var mainAppCtrls=angular.module("mainAppCtrls");mainAppCtrls.controller("LegalNoticeCtrl",["$scope","Admin","$sanitize",function($scope,Admin,$sanitize){Admin.getLegalNotice().$promise.then(function(response){$scope.legalNotice=response.content},function(response){})}]);var mainAppCtrls=angular.module("mainAppCtrls");mainAppCtrls.controller("LoginCtrl",["$scope","$http","store","$state","jwtHelper","$alert","$translate","Admin",function($scope,$http,store,$state,jwtHelper,$alert,$translate,Admin){$scope.reset_panel=!1;store.get("jwt");$scope.reset={};var _translations;$translate(["TITLE_ERROR","ALERT_LOGIN_FAIL","ALERT_RESET_EMAIL_ERROR","TITLE_SUCCESS","ALERT_RESET_PASSWORD_SUCCESS","ALERT_RESET_PASSWORD_ERROR"]).then(function(translation){_translations=translation}),$scope.sendInfo=function(){var _data={_username:$scope.e_mail,_password:$scope.password};$scope.alertError,$scope.loading=!0,null!=$scope.alertError&&$scope.alertError.hide(),$http({method:"POST",url:"/api/login_check",data:_data}).then(function(httpResponse){$scope.loading=!1;var token=httpResponse.data.token;store.set("jwt",token),$state.go("dashboard"),$scope.show_login=!1,$scope.show_logout=!0},function(httpResponse){$scope.loading=!1,$scope.alertError=$alert({title:_translations.TITLE_ERROR,type:"danger",container:"#alert",content:_translations.ALERT_LOGIN_FAIL,dismissable:!1,show:!0})})},$scope.showResetPanel=function(){$scope.reset_panel=!$scope.reset_panel},$scope.alertReset=$alert({}),$scope.resetPassword=function(){return $scope.alertReset.hide(),$scope.reset.email?(null!=$scope.alertReset&&$scope.alertReset.hide(),void Admin.requestReset({email:$scope.reset.email}).$promise.then(function(response){$scope.alertReset=$alert({title:_translations.TITLE_SUCCESS,content:_translations.ALERT_RESET_PASSWORD_SUCCESS,type:"success",dismissable:!1,show:!0,container:"#reset_alert"})},function(response){$scope.alertReset=$alert({title:_translations.TITLE_ERROR,content:_translations.ALERT_RESET_PASSWORD_ERROR,type:"danger",dismissable:!1,show:!0,container:"#reset_alert"})})):void($scope.alertReset=$alert({title:_translations.TITLE_ERROR,content:_translations.ALERT_RESET_EMAIL_ERROR,type:"danger",dismissable:!1,show:!0,container:"#reset_alert"}))}}]);var mainAppCtrls=angular.module("mainAppCtrls");mainAppCtrls.controller("NewEmailTemplateCtrl",["$scope","EmailTemplate","$translate","$alert","$state",function($scope,EmailTemplate,$translate,$alert,$state){var _translations={};$translate(["ALERT_EMAILTEMPLATE_NEW_SUCCESS","ALERT_EMAILTEMPLATE_NEW_FAIL","ALERT_EMAILTEMPLATE_NOT_FOUND","TITLE_ERROR","TITLE_SUCCESS"]).then(function(translations){_translations=translations}),$scope.sendInfo=function(){var data={template_name:$scope.email.template.title,email_subject:$scope.email.template.subject,email_body:$scope.email.template.body};EmailTemplate.put(data).$promise.then(function(httpResponse){$alert({title:_translations.TITLE_SUCCESS,
type:"success",content:_translations.ALERT_EMAILTEMPLATE_NEW_SUCCESS+' "'+data.template_name+'"',container:"#alert",dismissable:!1,show:!0})},function(httpResponse){$alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.ALERT_EMAILTEMPLATE_NEW_FAIL+" ("+httpResponse.status+")",container:"#alert",dismissable:!1,show:!0}),$state.go("email_template")})},$scope.discard=function(){$scope.email.template.title="",$scope.email.template.subject="",$scope.email.template.body=""}}]);var mainAppCtrls=angular.module("mainAppCtrls");mainAppCtrls.controller("NewWorkshopTemplateCtrl",["$scope","WorkshopTemplate","$translate","$alert","$state",function($scope,WorkshopTemplate,$translate,$alert,$state){$scope.workshop={},$scope.myAlert=$alert({});var _translations={};$translate(["ALERT_WORKSHOPTEMPLATE_NEW_SUCCESS","ALERT_WORKSHOPTEMPLATE_NEW_FAIL","ALERT_WORKSHOPTEMPLATE_NOT_FOUND","TITLE_ERROR","TITLE_SUCCESS"]).then(function(translations){_translations=translations}),$scope.workshop.duration=-36e5,$scope.sendInfo=function(){var reformatDate=function(_date){if(null==_date)return"";var str=_date.getFullYear()+"-"+(_date.getMonth()+1)+"-"+_date.getDate()+" ";return _date.getHours()<10&&(str+="0"),str+=_date.getHours()+":",_date.getMinutes()<10&&(str+="0"),str+=_date.getMinutes()+":",_date.getSeconds()<10&&(str+="0"),str+=_date.getSeconds()},_sa=new Date(0),_duration=$scope.workshop.duration,_ea=new Date(_duration),error=!1;$scope.workshop.cost<0&&($alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.ALERT_NEGATIVE_COST,container:"#alert",dismissable:!1,show:!0}),error=!0),$scope.workshop.max_participants<0&&($alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.ALERT_NEGATIVE_PARTICIPANTS,container:"#alert",dismissable:!1,show:!0}),error=!0);var now=new Date;if($scope.workshop.start_at<now&&($alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.ALERT_WORKSHOP_IN_PAST,container:"#alert",dismissable:!1,show:!0}),error=!0),error)return!1;var data={title:$scope.workshop.title,description:$scope.workshop.description,cost:$scope.workshop.cost,requirements:$scope.workshop.requirement,location:$scope.workshop.location,start_at:reformatDate(_sa),end_at:reformatDate(_ea),max_participants:$scope.workshop.max_participants};null!=$scope.myAlert&&$scope.myAlert.hide(),WorkshopTemplate.put(data).$promise.then(function(httpResponse){$scope.myAlert=$alert({container:"#alert",type:"success",title:_translations.TITLE_SUCCESS,content:_translations.ALERT_WORKSHOPTEMPLATE_NEW_SUCCESS+' "'+data.title+'"',show:!0,dismissable:!1}),$state.go("workshop_template")},function(httpResponse){$scope.myAlert=$alert({container:"#alert",type:"danger",title:_translations.TITLE_ERROR,content:_translations.ALERT_WORKSHOPTEMPLATE_NEW_FAIL+" ("+httpResponse.status+")",show:!0,dismissable:!1})})},$scope.discard=function(){$scope.workshop.title="",$scope.workshop.description="",$scope.workshop.cost="",$scope.workshop.requirement="",$scope.workshop.location="",$scope.workshop.sharedDate="",$scope.workshop.duration="",$scope.workshop.max_participants=""}}]);var mainAppCtrls=angular.module("mainAppCtrls");mainAppCtrls.controller("PasswordResetCtrl",["$scope","$alert","$translate","Admin","$stateParams",function($scope,$alert,$translate,Admin,$stateParams){$scope.form={};var _translations;$translate(["TITLE_ERROR","TITLE_SUCCESS","PASSWORDS_IDENTICAL_ERROR","PASSWORD_EMPTY_ERROR"]).then(function(translations){_translations=translations});var pwAlert,_token=$stateParams.token;$scope.validatePW=function(){var pw=$scope.password,pwc=$scope.password_confirm;return null!=pwAlert&&(pwAlert.hide(),pwAlert.destroy()),pw!=pwc?(pwAlert=$alert({container:"#alert",title:_translations.TITLE_ERROR,content:_translations.PASSWORDS_IDENTICAL_ERROR,show:!0,dismissable:!1,type:"danger"}),!1):(null!=pwAlert&&(pwAlert.hide(),pwAlert.destroy()),!0)},$scope.sendInfo=function(){if($scope.validatePW()){var pw=$scope.password;if(""==pw||null==pw)return void(pwAlert=$alert({container:"#alert",title:_translations.TITLE_ERROR,content:_translations.PASSWORD_EMPTY_ERROR,show:!0,dismissable:!1,type:"danger"}));var _msg="";Admin.resetPassword({token:_token,password:$scope.password}).$promise.then(function(httpResponse){pwAlert=$alert({container:"#alert",title:_translations.TITLE_SUCCESS,content:_msg,type:"success",show:!0,dismissable:!1})},function(httpResponse){switch(httpResponse.status){case 404:_msg="Invalid token";break;case 500:_msg="Internal server error. Please contact your system admin"}pwAlert=$alert({container:"#alert",title:_translations.TITLE_ERROR,content:_msg,type:"danger",show:!0,dismissable:!1})})}}}]);var mainAppCtrls=angular.module("mainAppCtrls");mainAppCtrls.controller("SettingsCtrl",["$scope","$alert","$confirm","Admin","$translate",function($scope,$alert,$confirm,Admin,$translate){var _translations={};$translate(["ALERT_PASSWORD_IDENTICAL","AlERT_PASSWORD_EMPTY","CHANGE_PERSONAL_INFO","CHANGE_CONTACT_INFO","EDIT_LEGAL_NOTICE","TITLE_SUCCESS","TITLE_ERROR"]).then(function(translations){_translations=translations,$scope.tabs=[{title:_translations.CHANGE_PERSONAL_INFO,page:"resources/views/adminEditPassword.html"},{title:_translations.CHANGE_CONTACT_INFO,page:"resources/views/adminEditInfo.html"},{title:_translations.EDIT_LEGAL_NOTICE,page:"resources/views/adminEditLegalNotice.html"}]});var _originalData={};$scope.form={},$scope.ln={},$scope.lnToolbar=[["h1","h2","h3","p","bold","italics"],["ul","ol"],["redo","undo","clear"],["html","insertImage","insertLink"],["justifyLeft","justifyCenter","justifyRight","indent","outdent"]];var _originalNotice="";Admin.getLegalNotice().$promise.then(function(value){$scope.ln.legalNotice=value.content,_originalNotice=value.content},function(value){$alert({title:_translations.TITLE_ERROR,type:"danger",content:value.message,container:"#alertInfo",dismissable:!1,show:!0})}),Admin.getContact().$promise.then(function(value){$scope.form=value.content},function(value){$alert({title:_translations.TITLE_ERROR,type:"danger",content:value.message,container:"#alertInfo",dismissable:!1,show:!0})}),$scope.pwAlert=null,$scope.emailAlert=null,$scope.validatePW=function(){var pw=$scope.form.password,pwc=$scope.form.password_confirm;return pw!=pwc?(null!=$scope.pwAlert&&$scope.pwAlert.hide(),$scope.pwAlert=$alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.ALERT_PASSWORD_IDENTICAL,container:"#pwalert",dismissable:!1,show:!0}),!1):(null!=$scope.pwAlert&&$scope.pwAlert.hide(),!0)},$scope.changePassword=function(){if($scope.validatePW()){if(null==$scope.form.password||""==$scope.form.password)return null!=$scope.pwAlert&&$scope.pwAlert.hide(),void($scope.pwAlert=$alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.AlERT_PASSWORD_EMPTY,container:"#pwalert",dismissable:!1,show:!0}));var _data={oldpassword:$scope.form.password_old,newpassword:$scope.form.password};Admin.changePassword(_data).$promise.then(function(value){null!=$scope.pwAlert&&$scope.pwAlert.hide(),$scope.pwAlert=$alert({title:_translations.TITLE_SUCCESS,type:"success",content:value.message,container:"#pwalert",dismissable:!1,show:!0}),$scope.form={}},function(value){null!=$scope.pwAlert&&$scope.pwAlert.hide(),$scope.pwAlert=$alert({title:_translations.TITLE_ALERT,type:"danger",content:value.data.message,container:"#pwalert",dismissable:!1,show:!0}),$scope.form={}})}},$scope.changeEmail=function(){null!=$scope.emailAlert&&$scope.emailAlert.hide();var _email_new=$scope.form.email_new,_email_old=$scope.form.email_old;null!=_email_new&&""!=_email_new||$alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.ALERT_EMAIL_EMPTY,container:"#alertInfo",dismissable:!1,show:!0}),null!=_email_old&&""!=_email_old||$alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.ALERT_OLDEMAIL_EMPTY,container:"#alertInfo",dismissable:!1,show:!0}),Admin.changeEmail({oldemail:_email_old,newemail:_email_new}).$promise.then(function(response){$scope.emailAlert=$alert({content:response.statusText,type:"success",title:_translations.TITLE_SUCCESS,show:!0,dismissable:!1,duration:30,container:"#emailAlert"}),$scope.form={}},function(response){$scope.emailAlert=$alert({content:response.statusText,type:"danger",title:_translations.TITLE_ERROR,show:!0,dismissable:!1,duration:30,container:"#emailAlert"}),$scope.form={}})},$scope.saveLegalNotice=function(){var _dataToSend={content:$scope.ln.legalNotice};console.log(_dataToSend.content),Admin.editLegalNotice(_dataToSend).$promise.then(function(value){$alert({title:_translations.TITLE_SUCCESS,type:"success",content:value.statusText,container:"#alertInfo",dismissable:!1,show:!0}),$scope.legalNotice=value.content},function(value){$alert({title:_translations.TITLE_ERROR,type:"danger",content:value.statusText,container:"#alertInfo",dismissable:!1,show:!0})})},$scope.discardLegalNotice=function(){$scope.ln.legalNotice=_originalNotice},$scope.discardContact=function(){$scope.form.telephone=_originalData.telephone,$scope.form.website=_originalData.website,$scope.form.address=_originalData.address,$scope.form.facebook=_originalData.facebook,$scope.form.email=_originalData.email},$scope.saveContactChange=function(){var _dataToSend={content:angular.toJson($scope.form)};Admin.editContact(_dataToSend).$promise.then(function(value){$alert({title:_translations.TITLE_SUCCESS,type:"success",content:value.message,container:"#alertInfo",dismissable:!1,show:!0})},function(value){$alert({title:_translations.TITLE_ERROR,type:"danger",content:value.message,container:"#alertInfo",dismissable:!1,show:!0})})}}]);var mainAppCtrls=angular.module("mainAppCtrls");mainAppCtrls.controller("UnsubscribeCtrl",["$scope","Workshops","$stateParams","$translate","$alert",function($scope,Workshops,$stateParams,$translate,$alert){var _userId=$stateParams.id,_workshopId=$stateParams.workshopid,_token=$stateParams.token;$scope.workshop={},$scope.alertUnsub=$alert({});var _translations={};$translate(["TITLE_ERROR","TITLE_SUCCESS","ALERT_WORKSHOP_NOT_FOUND","UNSUBSCRIBE_CONFIRM_ERROR","UNSUBSCRIBE_CONFIRM_SUCCESS"]).then(function(translations){_translations=translations}),$scope.confirm=function(){var _params={id:_workshopId,token:_token,participantId:_userId};$scope.working=!0,Workshops.unsubscribeConfirm(_params).$promise.then(function(response){$scope.alertUnsub.hide(),$scope.alertUnsub=$alert({title:_translations.TITLE_SUCCESS,type:"success",content:_translations.UNSUBSCRIBE_CONFIRM_SUCCESS,show:!0,container:"#alert",dismissable:!1}),$scope.working=!1},function(response){$scope.alertUnsub.hide(),$scope.alertUnsub=$alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.UNSUBSCRIBE_CONFIRM_ERROR,show:!0,container:"#alert",dismissable:!1}),$scope.working=!1})},$scope.loading=!0,$scope.error=!1,Workshops.getWorkshop({id:_workshopId}).$promise.then(function(response){$scope.workshop=response;var _ea=Date.parse($scope.workshop.end_at),_sa=Date.parse($scope.workshop.start_at);$scope.workshop.duration=new Date(_ea-_sa),$scope.loading=!1},function(response){$scope.alertUnsub.hide(),$scope.alertUnsub=$alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.ALERT_WORKSHOP_NOT_FOUND,show:!0,container:"#alert",dismissable:!1}),$scope.loading=!1,$scope.error=!0})}]);var mainAppCtrls=angular.module("mainAppCtrls");mainAppCtrls.controller("WorkshopDetailsCtrl",["$scope","Workshops","$stateParams","$alert","$translate",function($scope,Workshops,$stateParams,$alert,$translate){$scope.unsub={};var _translations={};$translate(["ALERT_ENROLLMENT_SUCCESSFULL","ALERT_NO_PARTICIPANTS","FIRST_NAME","LAST_NAME","EMAIL","ALERT_INTERNAL_SERVER_ERROR","ALERT_ALREADY_ENROLLED","TITLE_SUCCESS","TITLE_ERROR","ALERT_YOU_ARE_ON_BLACKLIST","ERROR_UNSUBSCRIBE_FAIL","UNSUBSCRIBE_SUCCESS"]).then(function(translations){_translations=translations,$scope.placeholder={firstname:_translations.FIRST_NAME,lastname:_translations.LAST_NAME,emailadress:_translations.EMAIL}});var workshopid=$stateParams.id;$scope.sendInfo=function(){var first_name=$scope.first_name,last_name=$scope.last_name,_email=$scope.e_mail,_data={name:first_name,surname:last_name,email:_email},_params={id:workshopid};Workshops.enroll(_params,_data).$promise.then(function(value,httpResponse){$alert({title:_translations.TITLE_SUCCESS,type:"success",content:_translations.ALERT_ENROLLMENT_SUCCESSFULL,container:"#alertEnroll",dismissable:!0,duration:20,show:!0,animation:"am-fade-and-slide-top"})},function(response){switch(response.status){case 403:$translate(response.data.message).then(function(_translation){console.log(response.data.message),$translate(response.data.message).then(function(_translation){$alert({type:"danger",title:_translations.TITLE_ERROR,content:_translation,show:!0,duration:20,container:"#alertEnroll",dismissable:!0})})});break;case 500:$alert({type:"danger",title:_translations.TITLE_ERROR,content:_translations.ALERT_INTERNAL_SERVER_ERROR,show:!0,duration:20,container:"#alertEnroll",dismissable:!0});break;default:$alert({type:"danger",title:_translations.TITLE_ERROR,content:response.data.message,show:!0,duration:20,container:"#alertEnroll",dismissable:!0})}})},$scope.unsubscribe=function(){var _data={email:$scope.unsub.e_mail,workshopId:workshopid};Workshops.unsubscribe(_data).$promise.then(function(response){$alert({type:"success",title:_translations.TITLE_SUCCESS,content:_translations.UNSUBSCRIBE_SUCCESS,dismissable:!0,duration:20,show:!0,container:"#alertEnroll"})},function(response){switch(response.status){case 404:console.log(response.data.message),$translate(response.data.message).then(function(_translation){$alert({type:"danger",title:_translations.TITLE_ERROR,content:_translation,show:!0,duration:20,container:"#alertEnroll",dismissable:!0})});break;default:$alert({type:"danger",title:_translations.TITLE_ERROR,content:_translations.ERROR_UNSUBSCRIBE_FAIL+": "+response.statusText,show:!0,duration:20,container:"#alertEnroll",dismissable:!0})}})},$scope.loading=!0,Workshops.get({id:workshopid}).$promise.then(function(value){$scope.workshop=value;var _ea=Date.parse($scope.workshop.end_at),_sa=Date.parse($scope.workshop.start_at),_durationInMs=_ea-_sa,_duration=("0"+Math.floor(_durationInMs/36e5)).slice(-2)+":"+("0"+Math.floor(_durationInMs%36e5/6e4)).slice(-2);$scope.workshop.duration=_duration,$scope.loading=!1},function(httpResponse){alert(httpResponse.status+""),$scope.loading=!1}),$scope.loading=!0,Workshops.getParticipants({id:workshopid}).$promise.then(function(value,httpResponse){$scope.participants=value,$scope.loading=!1},function(httpResponse){switch(httpResponse.status){case 404:$alert({title:"",type:"info",content:_translations.ALERT_NO_PARTICIPANTS,container:"#alertParticipant",dismissable:!1,show:!0,animation:"am-fade-and-slide-top"})}$scope.loading=!1}),$scope.loading=!0,Workshops.getWaitinglist({id:workshopid}).$promise.then(function(response){$scope.waitingList=response,$scope.loading=!1},function(response){$scope.loading=!1})}]);var mainAppCtrls=angular.module("mainAppCtrls");mainAppCtrls.controller("WorkshopListCtrl",["$scope","Workshops","$alert","$translate",function($scope,Workshops,$alert,$translate){$scope.myAlert,$translate(["TITLE_ERROR","ERROR_NO_WORKSHOPS","EMPTY_WORKSHOP","ALERT_INTERNAL_SERVER_ERROR","TITLE_INFO"]).then(function(translations){$scope.errorTitle=translations.TITLE_ERROR,$scope.errorMsg=translations.ERROR_NO_WORKSHOPS,$scope.emptyMsg=translations.EMPTY_WORKSHOP,$scope.InternalServerError=translations.ALERT_INTERNAL_SERVER_ERROR,$scope.infoTitle=translations.TITLE_INFO}),$scope.loading=!0,Workshops.getAll().$promise.then(function(value){$scope.workshopList=value,$scope.loading=!1,0==value.length&&($scope.myAlert=$alert({title:$scope.infoTitle,type:"info",content:$scope.errorMsg,container:"#alert",dismissable:!1,show:!0}))},function(httpResponse){switch(httpResponse.status){case 404:$scope.myAlert=$alert({title:$scope.errorTitle,type:"danger",content:$scope.errorMsg,container:"#alert",dismissable:!1,show:!0});break;case 500:$scope.myAlert=$alert({title:$scope.errorTitle,type:"danger",content:$scope.InternalServerError,container:"#alert",dismissable:!1,show:!0})}$scope.loading=!1})}]);var mainAppCtrls=angular.module("mainAppCtrls");mainAppCtrls.controller("WorkshopTemplateCtrl",["$scope","WorkshopTemplate","$translate","$alert",function($scope,WorkshopTemplate,$translate,$alert){var _translations={};$translate(["ALERT_WORKSHOPTEMPLATE_LIST_EMPTY","ALERT_WORKSHOPTEMPLATE_DELETED_SUCCESS","ALERT_WORKSHOPTEMPLATE_DELETED_FAIL","TITLE_SUCCESS","TITLE_ERROR","TITLE_WARNING"]).then(function(translations){_translations=translations});var loadTemplates=function(){$scope.loading=!0,WorkshopTemplate.getAll().$promise.then(function(value){$scope.data=value,$scope.loading=!1},function(httpResponse){404==httpResponse.status&&($scope.data={},$alert({title:_translations.TITLE_WARNING,type:"warning",container:"#alert",show:!0,dismissable:!1,content:_translations.ALERT_WORKSHOPTEMPLATE_LIST_EMPTY+" ("+httpResponse.status+")"})),$scope.loading=!1})};loadTemplates(),$scope.delete=function(_id){WorkshopTemplate.delete({id:_id}).$promise.then(function(httpresponse){$alert({title:_translations.TITLE_SUCCESS,type:"success",container:"#alert",show:!0,dismissable:!1,content:_translations.ALERT_WORKSHOPTEMPLATE_DELETED_SUCCESS,duration:20}),loadTemplates()},function(httpResponse){$alert({title:_translations.TITLE_ERROR,type:"danger",content:_translations.ALERT_WORKSHOPTEMPLATE_DELETED_FAIL+" ("+httpResponse.status+")",container:"#alert",dismissable:!1,show:!0})})}}]);