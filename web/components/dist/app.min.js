var mainApp=angular.module("mainApp",["ngRoute","mainAppCtrls","mgcrea.ngStrap","ui.router","angular-jwt","restSvcs","angular-storage","pascalprecht.translate","textAngular","prntSvcs"]),mainAppCtrls=angular.module("mainAppCtrls",["pascalprecht.translate","ngSanitize"]);mainApp.config(["$urlRouterProvider","$stateProvider",function($urlRouterProvider,$stateProvider){var prefix="resources/views/";$stateProvider.state("workshops",{url:"/workshops",controller:"WorkshopListCtrl",templateUrl:prefix.concat("workshopList.html")}).state("workshopsdetails",{url:"/workshops/details/:id",controller:"WorkshopDetailsCtrl",templateUrl:prefix.concat("workshopDetails.html")}).state("login",{url:"/login",controller:"LoginCtrl",templateUrl:prefix.concat("login.html")}).state("enrollment_confirm",{url:"/enrollment/confirm/:workshopid/:userid/:token",templateUrl:prefix.concat("enrollmentConfirm.html"),controller:"EnrollmentConfirmCtrl"}).state("unsubscribe",{url:"/unsubscribe/:id/:workshopid/:token",templateUrl:prefix.concat("unsubscribemessage.html"),controller:"UnsubscribeCtrl"}).state("password_reset",{url:"/password/reset/:token",templateUrl:prefix.concat("passwordReset.html"),controller:"PasswordResetCtrl"}).state("dashboard",{url:"/dashboard",controller:"DashboardCtrl",templateUrl:prefix.concat("adminDashboard.html"),data:{requiresLogin:!0}}).state("workshop_template",{url:"/workshop/template",controller:"WorkshopTemplateCtrl",templateUrl:prefix.concat("adminWorkshopTemplate.html"),data:{requiresLogin:!0}}).state("workshop_template_new",{url:"/workshop/template/new",controller:"NewWorkshopTemplateCtrl",templateUrl:prefix.concat("adminNewWorkshopTemplate.html"),data:{requiresLogin:!0}}).state("workshop_template_edit",{url:"/workshop/template/edit/:id",controller:"EditWorkshopTemplateCtrl",templateUrl:prefix.concat("adminNewWorkshopTemplate.html"),data:{requiresLogin:!0}}).state("email_template",{url:"/email/template",controller:"EmailTemplateCtrl",templateUrl:prefix.concat("adminEmailTemplate.html"),data:{requiresLogin:!0}}).state("email_template_new",{url:"/email/template/new",controller:"NewEmailTemplateCtrl",templateUrl:prefix.concat("adminNewEmailTemplate.html"),data:{requiresLogin:!0}}).state("email_template_edit",{url:"/email/template/edit/:id",controller:"EditEmailTemplateCtrl",templateUrl:prefix.concat("adminEditEmailTemplate.html"),data:{requiresLogin:!0}}).state("blacklist",{url:"/blacklist",controller:"BlacklistCtrl",templateUrl:prefix.concat("adminBlacklist.html"),data:{requiresLogin:!0}}).state("administrator_management",{url:"/admins",controller:"AdministratorManagementCtrl",templateUrl:prefix.concat("administratorManagement.html"),data:{requiresLogin:!0}}).state("administrator_workshop_details",{url:"/workshop/management/details/:id",controller:"adminWorkshopDetailsCtrl",templateUrl:prefix.concat("adminWorkshopDetails.html"),data:{requiresLogin:!0}}).state("admin_email_confirm",{url:"/workshop/management/details/:id/confirm",controller:"adminEmailConfirmCtrl",templateUrl:prefix.concat("adminEmailConfirm.html"),data:{requiresLogin:!0}}).state("admin_workshop_management",{url:"/workshop/management",controller:"adminWorkshopManagementCtrl",templateUrl:prefix.concat("adminWorkshopManagement.html"),data:{requiresLogin:!0}}).state("admin_workshop_new",{url:"/workshop/management/new",controller:"AdminNewWorkshopCtrl",templateUrl:prefix.concat("adminNewWorkshop.html"),data:{requiresLogin:!0}}).state("admin_workshop_edit",{url:"/workshop/management/edit/:id",controller:"AdminEditWorkshopCtrl",templateUrl:prefix.concat("adminEditWorkshop.html"),data:{requiresLogin:!0}}).state("settings",{url:"/settings",controller:"SettingsCtrl",templateUrl:prefix.concat("adminSettings.html"),data:{requiresLogin:!0}}).state("admininvite",{url:"/admin/create/:token",controller:"AdminCreateCtrl",templateUrl:prefix.concat("adminInvite.html")}).state("legalnotice",{url:"/legalnotice",controller:"LegalNoticeCtrl",templateUrl:prefix.concat("legalNotice.html")}).state("contact",{url:"/contact",controller:"ContactCtrl",templateUrl:prefix.concat("contact.html")}),$urlRouterProvider.otherwise("/workshops")}]),mainApp.config(["jwtInterceptorProvider","$httpProvider","$urlRouterProvider",function(jwtInterceptorProvider,$httpProvider,$urlRouterProvider){jwtInterceptorProvider.tokenGetter=function(store){return store.get("jwt")},$httpProvider.interceptors.push("jwtInterceptor")}]).run(["$rootScope","$state","store","jwtHelper",function($rootScope,$state,store,jwtHelper){$rootScope.$on("$stateChangeStart",function(e,to){to.data&&to.data.requiresLogin&&(store.get("jwt")&&!jwtHelper.isTokenExpired(store.get("jwt"))||(store.get("jwt")&&store.remove("jwt"),e.preventDefault(),$state.go("login")))})}]),mainApp.config(["$translateProvider",function($translateProvider){$translateProvider.useSanitizeValueStrategy("escape"),$translateProvider.useStaticFilesLoader({prefix:"resources/local/lang-",suffix:".json"}),$translateProvider.preferredLanguage("de")}]),mainApp.controller("GlobalCtrl",["$scope","store","jwtHelper","$state","$http","$translate",function($scope,store,jwtHelper,$state,$http,$translate,$translateProvider){$scope.back=function(){$scope.show_login&&$state.go("workshops"),$scope.show_logout&&$state.go("dashboard"),$scope.show_logout&&"dashboard"==$state.current.name&&$state.go("workshops"),"login"==$state.current.name&&$state.go("workshops")};var jwt=store.get("jwt");null!=jwt&&jwtHelper.isTokenExpired(jwt)&&store.remove("jwt"),$http.get("resources/local/config.json").then(function(response){$scope.langs=response.data.lang,$translate.use(response.data.default);for(var i=0;i<$scope.langs.length;i++)response.data.default===$scope.langs[i].code&&($scope.selectedLang=$scope.langs[i])},function(response){}),$scope.show_login=!0,$scope.show_logout=!1,$scope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){var jwt=store.get("jwt");"login"==toState.name?($scope.show_login=!1,$scope.previousState=fromState,null==jwt||jwtHelper.isTokenExpired(jwt)||(event.preventDefault(),$state.go(fromState))):null!=jwt?($scope.show_login=jwtHelper.isTokenExpired(jwt),$scope.show_logout=!jwtHelper.isTokenExpired(jwt)):($scope.show_login=!0,$scope.show_logout=!1),null!=jwt&&jwtHelper.isTokenExpired(jwt)&&store.remove(jwt)}),$scope.logout=function(){var jwt=store.get("jwt");null!=jwt?(store.remove("jwt"),$scope.show_login=!0,$scope.show_logout=!1,$state.current.data.requiresLogin&&$state.go("workshops")):($scope.show_login=!0,$scope.show_logout=!1)},$scope.changeLang=function(){$translate.use($scope.selectedLang.code)}}]),mainApp.directive("compareTo",[function(){return{require:"ngModel",scope:{otherModelValue:"=compareTo"},link:function(scope,element,attributes,ngModel){ngModel.$validators.compareTo=function(modelValue){return modelValue==scope.otherModelValue},scope.$watch("otherModelValue",function(){ngModel.$validate()})}}}]),mainApp.service("$confirm",function($modal,$rootScope,$q){var deferred,scope=$rootScope.$new();scope.title="to be changed",scope.content="to be changed",scope.answer=function(res){deferred.resolve(res),confirm.hide()};var confirm=$modal({templateUrl:"resources/views/confirm.tpl.html",scope:scope,show:!1,dismissable:!1}),parentShow=confirm.show;return confirm.show=function(){return deferred=$q.defer(),parentShow(),deferred.promise},confirm});